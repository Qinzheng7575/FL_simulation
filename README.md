## 环境

- python 3.7.12
- torch 1.4.0
- torchvision 0.5.0
- syft 0.2.4

## 文件结构：

FL_simu.py 是真正运行的代码，剩余代码是为了我方便对照留下的

## 代码架构

按照 FL 的运行逻辑，如下几个步骤:

1. 初始化 ue`init_ue()`,BS`BS_model`，
2. 加载、分发数据(`alloc()`)，开始本地训练(`ue.train()`)，
3. 每训练若干 epoch（聚合频率`train_args['aggre_interval']`），就将 model 进行上传操作(`tranport()`)，**传输函数待完善**
4. BS 聚合模型(`aggregate`)，测试(`test()`)，分发
5. 进入下一轮

## 分级上传版本改进 9.8

- 先打印 model 出来看看
- 寻找量化方法，应用在 tensor 上；量化后还要组合在一起
- 量化运用在 model 上，看前后数据量大小
- 融合进训练中

师姐，给你汇报一下现在的进展。经过几次试错，打算对要传输的 model 进行分级上传的操作如下：将 model（tensor 类）转换为 python 列表，再将列表中的每个元素（float 类，）转换为字符串，再将字符串转化为字节流，对此字节流进行截断就可以实现把一个浮点数分成基础部分和增量部分。
如何将一个列表套列表的复杂矩阵的每一个元素进行这样的精准操作（考虑到后面还需要合并，还要适应多种模型），我打算利用递归方法进行操作！希望此思路能够成功。

https://blog.csdn.net/weixin_55749979/article/details/125574931

打印、保存模型：
https://www.cnblogs.com/shuangcao/p/12030206.html
模型在训练前后分别范围都是\[(+-)7.1041e-05,5.5031e-03,0.3178\]

目前发现，python 保存的都是小数点后 4 位（浮点数表示）

### 对矩阵进行操作

https://zhuanlan.zhihu.com/p/429901066

#### 9.11 记录

今天主要实现了对传输模型的数据分割
遇到如下问题：

- 应该操作的是模型的参数，也就是`model.state_dict()`，然后发现这是一个有序字典，而不是简单的 tensor，其中字典的`value`才是里面每个层的具体参数。
- 由于 python 的赋值都是引用，也就是都是指针而不是值传递，因此注意对列表操作的引用与返回。
- 用`isinstance()`进行数据类型判断
- 使用递归的时候，如果只是对其中的元素进行操作而不需要记录保存的时候，不用 return
- pytorch 打印 tensor 的时候，会因为元素过多而出现省略号这极大的影响了判断，应该在导入包时候加上`torch.set_printoptions(threshold=np.inf)`
  取得结果:
- 确实能够极大减少单次的传输大小，17mb 减小到 9mb

待解决的问题

- 含负号问题
- 科学计数法，含 e-1 问题
- 分片转化为可用的 tensor 问题（解决之后就立刻做仿真实验）
- 分片重组问题
